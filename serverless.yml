service: salmon-wallet-app

frameworkVersion: '3'

plugins:
  - serverless-s3-sync

provider:
  name: aws
  runtime: nodejs16.x
  stage: ${opt:stage}
  region: 'us-east-1'
  deploymentMethod: direct
  environment: ${file(env.${opt:stage, self:provider.stage}.json)}

custom:
  bucketName: salmon-wallet-app-${opt:stage}
  s3Sync:
    - bucketName: ${self:custom.bucketName}
      localDir: build

# Note: ReactAppBucket and CloudFrontDistribution are managed outside CloudFormation
# The bucket salmon-wallet-app-prod and CloudFront E2NZ6X31C2VZEL already exist
# This config only syncs files to the existing bucket

resources:
  Resources:
    S3AccessPolicy:
      Type: AWS::S3::BucketPolicy
      Properties:
        Bucket: ${self:custom.bucketName}
        PolicyDocument:
          Statement:
            - Sid: PublicReadGetObject
              Effect: Allow
              Principal: '*'
              Action:
                - s3:GetObject
              Resource: arn:aws:s3:::${self:custom.bucketName}/*
